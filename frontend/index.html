<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Alpha ‚Äî Smart Opportunity Matcher</title>
  <meta name="description"
    content="Upload your resume and instantly discover internships, startups, and skill-based opportunities matched to your profile." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <style>
    /* ============================================================
       DESIGN TOKENS
       ============================================================ */
    :root {
      --bg: #0b0f1a;
      --bg-card: rgba(255, 255, 255, 0.04);
      --bg-glass: rgba(255, 255, 255, 0.06);
      --border: rgba(255, 255, 255, 0.08);
      --text: #e2e8f0;
      --text-dim: #94a3b8;
      --text-muted: #64748b;
      --accent: #6366f1;
      --accent-h: #818cf8;
      --green: #22c55e;
      --green-bg: rgba(34, 197, 94, 0.12);
      --yellow: #eab308;
      --yellow-bg: rgba(234, 179, 8, 0.12);
      --red: #ef4444;
      --red-bg: rgba(239, 68, 68, 0.10);
      --blue: #3b82f6;
      --blue-bg: rgba(59, 130, 246, 0.10);
      --radius: 12px;
      --radius-sm: 8px;
      --font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --transition: 0.25s cubic-bezier(.4, 0, .2, 1);
    }

    /* ============================================================
       RESET & BASE
       ============================================================ */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* ============================================================
       LAYOUT
       ============================================================ */
    .app-wrapper {
      max-width: 960px;
      margin: 0 auto;
      padding: 40px 24px 80px;
    }

    /* ============================================================
       HEADER
       ============================================================ */
    .header {
      text-align: center;
      margin-bottom: 48px;
    }

    .header__logo {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .header__icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent), #a855f7);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .header__title {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #e2e8f0, #a855f7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header__sub {
      color: var(--text-dim);
      font-size: 15px;
      max-width: 520px;
      margin: 0 auto;
    }

    /* ============================================================
       TABS
       ============================================================ */
    .tabs {
      display: flex;
      gap: 4px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 4px;
      margin-bottom: 32px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px 16px;
      background: transparent;
      border: none;
      border-radius: 8px;
      color: var(--text-dim);
      font-family: var(--font);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .tab-btn:hover {
      color: var(--text);
    }

    .tab-btn.active {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 2px 12px rgba(99, 102, 241, 0.3);
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* ============================================================
       UPLOAD ZONE
       ============================================================ */
    .upload-zone {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 56px 24px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      background: var(--bg-card);
      position: relative;
    }

    .upload-zone:hover,
    .upload-zone.dragover {
      border-color: var(--accent);
      background: rgba(99, 102, 241, 0.06);
    }

    .upload-zone__icon {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: 0.7;
    }

    .upload-zone__text {
      font-size: 16px;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 6px;
    }

    .upload-zone__hint {
      font-size: 13px;
      color: var(--text-muted);
    }

    .upload-zone input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .file-selected {
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
      color: var(--green);
    }

    /* ============================================================
       BUTTON
       ============================================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 28px;
      border: none;
      border-radius: var(--radius-sm);
      font-family: var(--font);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #a855f7);
      color: #fff;
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
      margin-top: 24px;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 24px rgba(99, 102, 241, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ============================================================
       LOADER
       ============================================================ */
    .loader-wrap {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      margin: 40px 0;
    }

    .loader-wrap.active {
      display: flex;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loader-wrap p {
      color: var(--text-dim);
      font-size: 14px;
    }

    /* ============================================================
       RESULTS
       ============================================================ */
    .results {
      display: none;
    }

    .results.active {
      display: block;
      animation: fadeUp 0.4s ease;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Skills Chips */
    .skills-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 36px;
    }

    .skill-chip {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      background: var(--blue-bg);
      color: var(--blue);
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    /* Match Card */
    .match-card {
      background: var(--bg-glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 16px;
      transition: var(--transition);
    }

    .match-card:hover {
      border-color: rgba(99, 102, 241, 0.3);
      background: rgba(255, 255, 255, 0.07);
    }

    .match-card__header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }

    .match-card__rank {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--accent), #a855f7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: #fff;
      flex-shrink: 0;
    }

    .match-card__info {
      flex: 1;
    }

    .match-card__title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .match-card__org {
      font-size: 13px;
      color: var(--text-dim);
    }

    /* Score Badge */
    .score-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .score-high {
      background: var(--green-bg);
      color: var(--green);
    }

    .score-medium {
      background: var(--yellow-bg);
      color: var(--yellow);
    }

    .score-low {
      background: var(--red-bg);
      color: var(--red);
    }

    /* Score Breakdown */
    .score-breakdown {
      display: flex;
      gap: 24px;
      margin-bottom: 16px;
      font-size: 13px;
    }

    .score-breakdown__item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .score-breakdown__label {
      color: var(--text-muted);
    }

    .score-breakdown__value {
      font-weight: 600;
    }

    /* Progress Bar */
    .progress-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .progress-bar__fill {
      height: 100%;
      border-radius: 3px;
      background: linear-gradient(90deg, var(--accent), var(--green));
      transition: width 0.6s ease;
    }

    /* Matched / Missing skills in card */
    .match-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .match-skills__chip {
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
    }

    .match-skills__chip--matched {
      background: var(--green-bg);
      color: var(--green);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .match-skills__chip--missing {
      background: var(--red-bg);
      color: var(--red);
      border: 1px solid rgba(239, 68, 68, 0.15);
    }

    .skills-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 12px;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Skill Gap Section */
    .gap-list {
      margin-bottom: 36px;
    }

    .gap-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
    }

    .gap-item__dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .gap-item__dot--critical {
      background: var(--red);
    }

    .gap-item__dot--preferred {
      background: var(--yellow);
    }

    .gap-item__skill {
      font-weight: 500;
      flex: 1;
    }

    .gap-item__badge {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 3px 8px;
      border-radius: 4px;
    }

    .gap-item__badge--critical {
      background: var(--red-bg);
      color: var(--red);
    }

    .gap-item__badge--preferred {
      background: var(--yellow-bg);
      color: var(--yellow);
    }

    .gap-item__advice {
      font-size: 13px;
      color: var(--text-dim);
      margin-top: 6px;
      line-height: 1.5;
      padding-left: 22px;
    }

    .gap-item-wrap {
      padding: 14px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
    }

    .gap-item-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Advice Box */
    .advice-box {
      padding: 16px 20px;
      border-radius: var(--radius);
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(168, 85, 247, 0.08));
      border: 1px solid rgba(99, 102, 241, 0.15);
      font-size: 14px;
      line-height: 1.7;
      color: var(--text);
      margin-bottom: 20px;
    }

    .advice-box--overall {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.06), rgba(59, 130, 246, 0.06));
      border: 1px solid rgba(34, 197, 94, 0.15);
      margin-bottom: 32px;
    }

    .advice-box__label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--accent-h);
      margin-bottom: 6px;
    }

    .advice-box--overall .advice-box__label {
      color: var(--green);
    }

    /* LinkedIn Link */
    .linkedin-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      padding: 6px 14px;
      border-radius: 6px;
      background: rgba(0, 119, 181, 0.12);
      color: #0077B5;
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
    }

    .linkedin-link:hover {
      background: rgba(0, 119, 181, 0.22);
    }

    /* ============================================================
       OPPORTUNITIES TABLE
       ============================================================ */
    .search-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .search-input {
      flex: 1;
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text);
      font-family: var(--font);
      font-size: 14px;
      outline: none;
      transition: var(--transition);
    }

    .search-input:focus {
      border-color: var(--accent);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .filter-select {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text);
      font-family: var(--font);
      font-size: 14px;
      outline: none;
      cursor: pointer;
      min-width: 160px;
    }

    .filter-select option {
      background: var(--bg);
    }

    .opp-card {
      background: var(--bg-glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 12px;
      transition: var(--transition);
    }

    .opp-card:hover {
      border-color: rgba(99, 102, 241, 0.3);
    }

    .opp-card__top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 8px;
    }

    .opp-card__title {
      font-size: 15px;
      font-weight: 600;
    }

    .opp-card__org {
      font-size: 13px;
      color: var(--text-dim);
    }

    .opp-card__meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .meta-tag {
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .meta-tag--type {
      background: rgba(99, 102, 241, 0.12);
      color: var(--accent-h);
    }

    .meta-tag--location {
      background: rgba(255, 255, 255, 0.06);
      color: var(--text-dim);
    }

    .opp-count {
      color: var(--text-muted);
      font-size: 13px;
      margin-bottom: 16px;
    }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
      font-size: 14px;
    }

    /* ============================================================
       ERROR
       ============================================================ */
    .error-msg {
      display: none;
      padding: 16px;
      border-radius: var(--radius-sm);
      background: var(--red-bg);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--red);
      font-size: 14px;
      margin-top: 16px;
    }

    .error-msg.active {
      display: block;
    }

    /* ============================================================
       RESPONSIVE
       ============================================================ */
    @media (max-width: 640px) {
      .app-wrapper {
        padding: 24px 16px 60px;
      }

      .header__title {
        font-size: 22px;
      }

      .match-card__header {
        flex-direction: column;
      }

      .score-breakdown {
        flex-direction: column;
        gap: 8px;
      }

      .search-bar {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div class="app-wrapper">
    <!-- ==================== HEADER ==================== -->
    <header class="header">
      <div class="header__logo">
        <div class="header__icon">Œ±</div>
        <h1 class="header__title">Project Alpha</h1>
      </div>
      <p class="header__sub">Upload your resume and instantly discover opportunities matched to your skills</p>
    </header>

    <!-- ==================== TABS ==================== -->
    <div class="tabs" id="tabs">
      <button class="tab-btn active" data-tab="match">üéØ Match Resume</button>
      <button class="tab-btn" data-tab="explore">üìã Explore Opportunities</button>
    </div>

    <!-- ==================== TAB 1: MATCH ==================== -->
    <div class="tab-panel active" id="panel-match">

      <!-- Upload -->
      <div class="upload-zone" id="upload-zone">
        <input type="file" id="file-input" accept=".pdf" />
        <div class="upload-zone__icon">üìÑ</div>
        <div class="upload-zone__text">Drop your resume here or click to browse</div>
        <div class="upload-zone__hint">PDF format only ‚Ä¢ Max 10 MB</div>
        <div class="file-selected" id="file-selected" style="display:none">
          <span>‚úì</span> <span id="file-name"></span>
        </div>
      </div>

      <div style="text-align:center">
        <button class="btn btn-primary" id="analyze-btn" disabled>
          <span id="btn-text">Analyze Resume</span>
        </button>
      </div>

      <!-- Error -->
      <div class="error-msg" id="error-msg"></div>

      <!-- Loader -->
      <div class="loader-wrap" id="loader">
        <div class="spinner"></div>
        <p>Extracting skills and matching opportunities‚Ä¶</p>
      </div>

      <!-- Results -->
      <div class="results" id="results">
        <!-- Overall Advice -->
        <div id="overall-advice-wrap"></div>

        <!-- Extracted Skills -->
        <div>
          <h2 class="section-title">üß† Extracted Skills</h2>
          <div class="skills-grid" id="skills-grid"></div>
        </div>

        <!-- Top Matches -->
        <div>
          <h2 class="section-title">üéØ Top Matches</h2>
          <div id="matches-list"></div>
        </div>

        <!-- Skill Gaps -->
        <div>
          <h2 class="section-title">üìä Skill Gap Analysis</h2>
          <div class="gap-list" id="gap-list"></div>
        </div>
      </div>
    </div>

    <!-- ==================== TAB 2: EXPLORE ==================== -->
    <div class="tab-panel" id="panel-explore">
      <div class="search-bar">
        <input class="search-input" id="search-input" placeholder="Search by title, company, or skill‚Ä¶" />
        <select class="filter-select" id="filter-type">
          <option value="">All Types</option>
          <option value="internship">Internship</option>
          <option value="full-time">Full-time</option>
        </select>
      </div>
      <div class="opp-count" id="opp-count"></div>
      <div id="opp-list"></div>
    </div>
  </div>

  <script>
    // ==============================================================
    // CONFIG
    // ==============================================================
    const API = 'http://localhost:8000';

    // ==============================================================
    // DOM REFS
    // ==============================================================
    const $ = (sel) => document.querySelector(sel);
    const fileInput   = $('#file-input');
    const uploadZone  = $('#upload-zone');
    const fileSelected= $('#file-selected');
    const fileName    = $('#file-name');
    const analyzeBtn  = $('#analyze-btn');
    const btnText     = $('#btn-text');
    const loaderEl    = $('#loader');
    const resultsEl   = $('#results');
    const errorEl     = $('#error-msg');
    const skillsGrid  = $('#skills-grid');
    const matchesList = $('#matches-list');
    const gapList     = $('#gap-list');
    const searchInput = $('#search-input');
    const filterType  = $('#filter-type');
    const oppList     = $('#opp-list');
    const oppCount    = $('#opp-count');

    let selectedFile = null;
    let allOpportunities = [];

    // ==============================================================
    // TABS
    // ==============================================================
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        $(`#panel-${btn.dataset.tab}`).classList.add('active');

        if (btn.dataset.tab === 'explore' && allOpportunities.length === 0) {
          loadOpportunities();
        }
      });
    });

    // ==============================================================
    // FILE UPLOAD
    // ==============================================================
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });
    uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) handleFile(fileInput.files[0]);
    });

    function handleFile(file) {
      if (file.type !== 'application/pdf') {
        showError('Please upload a PDF file.');
        return;
      }
      if (file.size > 10 * 1024 * 1024) {
        showError('File too large. Max 10 MB.');
        return;
      }
      selectedFile = file;
      fileName.textContent = file.name;
      fileSelected.style.display = 'flex';
      analyzeBtn.disabled = false;
      hideError();
    }

    // ==============================================================
    // ANALYZE
    // ==============================================================
    analyzeBtn.addEventListener('click', async () => {
      if (!selectedFile) return;
      hideError();
      resultsEl.classList.remove('active');
      loaderEl.classList.add('active');
      analyzeBtn.disabled = true;
      btnText.textContent = 'Analyzing‚Ä¶';

      try {
        const form = new FormData();
        form.append('file', selectedFile);

        const res = await fetch(`${API}/upload_resume`, { method: 'POST', body: form });
        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.detail || `Server error (${res.status})`);
        }
        const data = await res.json();
        renderResults(data);
      } catch (err) {
        showError(err.message);
      } finally {
        loaderEl.classList.remove('active');
        analyzeBtn.disabled = false;
        btnText.textContent = 'Analyze Resume';
      }
    });

    // ==============================================================
    // RENDER RESULTS
    // ==============================================================
    function renderResults(data) {
      // Overall Advice
      const overallWrap = $('#overall-advice-wrap');
      if (data.overall_advice) {
        overallWrap.innerHTML = `
          <div class="advice-box advice-box--overall">
            <div class="advice-box__label">üí° Your Personalized Summary</div>
            ${escHtml(data.overall_advice)}
          </div>`;
      } else {
        overallWrap.innerHTML = '';
      }

      // Skills
      skillsGrid.innerHTML = data.extracted_skills
        .map(s => `<span class="skill-chip">${escHtml(s)}</span>`)
        .join('');

      // Matches
      matchesList.innerHTML = data.matches.map((m, i) => {
        const pct = Math.round(m.skill_overlap_ratio * 100);
        const scoreClass = m.match_score >= 0.65 ? 'score-high'
                         : m.match_score >= 0.45 ? 'score-medium'
                         : 'score-low';
        const linkedinHtml = m.linkedin_url
          ? `<a class="linkedin-link" href="${escAttr(m.linkedin_url)}" target="_blank" rel="noopener">üîó View on LinkedIn</a>`
          : '';
        return `
          <div class="match-card">
            <div class="match-card__header">
              <div class="match-card__rank">${i + 1}</div>
              <div class="match-card__info">
                <div class="match-card__title">${escHtml(m.title)}</div>
                <div class="match-card__org">${escHtml(m.organisation)}</div>
              </div>
              <div class="score-badge ${scoreClass}">${(m.match_score * 100).toFixed(1)}%</div>
            </div>

            <div class="progress-bar">
              <div class="progress-bar__fill" style="width:${pct}%"></div>
            </div>

            ${m.advice ? `
              <div class="advice-box">
                <div class="advice-box__label">ü§ñ AI Insight</div>
                ${escHtml(m.advice)}
              </div>` : ''}

            <div class="score-breakdown">
              <div class="score-breakdown__item">
                <span class="score-breakdown__label">Semantic Match</span>
                <span class="score-breakdown__value">${(m.semantic_score * 100).toFixed(1)}%</span>
              </div>
              <div class="score-breakdown__item">
                <span class="score-breakdown__label">Skill Overlap</span>
                <span class="score-breakdown__value">${pct}%</span>
              </div>
              <div class="score-breakdown__item">
                <span class="score-breakdown__label">Skills Matched</span>
                <span class="score-breakdown__value">${m.matched_skills.length} / ${m.matched_skills.length + m.missing_skills.length}</span>
              </div>
            </div>

            ${m.matched_skills.length ? `
              <div class="skills-label">‚úÖ Matched Skills</div>
              <div class="match-skills">
                ${m.matched_skills.map(s => `<span class="match-skills__chip match-skills__chip--matched">${escHtml(s)}</span>`).join('')}
              </div>` : ''}

            ${m.missing_skills.length ? `
              <div class="skills-label">‚ùå Missing Skills</div>
              <div class="match-skills">
                ${m.missing_skills.map(s => `<span class="match-skills__chip match-skills__chip--missing">${escHtml(s)}</span>`).join('')}
              </div>` : ''}

            ${linkedinHtml}
          </div>`;
      }).join('');

      // Gaps with advice
      if (data.skill_gaps.length === 0) {
        gapList.innerHTML = '<div class="empty-state">‚ú® No skill gaps ‚Äî you perfectly match these roles!</div>';
      } else {
        gapList.innerHTML = data.skill_gaps.map(g => `
          <div class="gap-item-wrap">
            <div class="gap-item-row">
              <div class="gap-item__dot gap-item__dot--${g.importance}"></div>
              <div class="gap-item__skill">${escHtml(g.skill)}</div>
              <div class="gap-item__badge gap-item__badge--${g.importance}">${g.importance}</div>
            </div>
            ${g.advice ? `<div class="gap-item__advice">üí° ${escHtml(g.advice)}</div>` : ''}
          </div>`).join('');
      }

      resultsEl.classList.add('active');
    }

    // ==============================================================
    // OPPORTUNITIES
    // ==============================================================
    async function loadOpportunities() {
      oppList.innerHTML = '<div class="loader-wrap active"><div class="spinner"></div><p>Loading opportunities‚Ä¶</p></div>';
      try {
        const res = await fetch(`${API}/opportunities`);
        allOpportunities = await res.json();
        renderOpportunities(allOpportunities);
      } catch (err) {
        oppList.innerHTML = `<div class="empty-state">Failed to load opportunities.</div>`;
      }
    }

    function renderOpportunities(list) {
      oppCount.textContent = `${list.length} opportunities found`;
      if (list.length === 0) {
        oppList.innerHTML = '<div class="empty-state">No opportunities match your filters.</div>';
        return;
      }
      oppList.innerHTML = list.map(o => {
        const linkedinHtml = o.linkedin_url
          ? `<a class="linkedin-link" href="${escAttr(o.linkedin_url)}" target="_blank" rel="noopener">üîó View on LinkedIn</a>`
          : '';
        return `
        <div class="opp-card">
          <div class="opp-card__top">
            <div>
              <div class="opp-card__title">${escHtml(o.title)}</div>
              <div class="opp-card__org">${escHtml(o.organisation)}</div>
            </div>
          </div>
          <div class="opp-card__meta">
            <span class="meta-tag meta-tag--type">${escHtml(o.type)}</span>
            <span class="meta-tag meta-tag--location">üìç ${escHtml(o.location)}</span>
          </div>
          ${o.required_skills && o.required_skills.length ? `
            <div class="skills-label" style="margin-top:12px">Required Skills</div>
            <div class="match-skills">
              ${o.required_skills.slice(0, 8).map(s => `<span class="match-skills__chip match-skills__chip--matched">${escHtml(s)}</span>`).join('')}
              ${o.required_skills.length > 8 ? `<span class="match-skills__chip match-skills__chip--matched">+${o.required_skills.length - 8} more</span>` : ''}
            </div>` : ''}
          ${linkedinHtml}
        </div>`;
      }).join('');
    }

    searchInput.addEventListener('input', filterOpps);
    filterType.addEventListener('change', filterOpps);

    function filterOpps() {
      const q = searchInput.value.toLowerCase().trim();
      const type = filterType.value;
      const filtered = allOpportunities.filter(o => {
        const matchType = !type || o.type === type;
        const matchQ = !q || 
          o.title.toLowerCase().includes(q) ||
          o.organisation.toLowerCase().includes(q) ||
          (o.required_skills || []).some(s => s.toLowerCase().includes(q));
        return matchType && matchQ;
      });
      renderOpportunities(filtered);
    }

    // ==============================================================
    // UTILS
    // ==============================================================
    function escHtml(s) {
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }
    function escAttr(s) {
      return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }
    function showError(msg) { errorEl.textContent = msg; errorEl.classList.add('active'); }
    function hideError() { errorEl.classList.remove('active'); }
  </script>
</body>

</html>